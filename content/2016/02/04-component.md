+++
date = "2016-02-05T01:06:09+09:00"
description = "継承よりは集約が好き"
title = "Goと集約"

+++

<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr">Qiita:Teamにゲームなんて仕様ガンガン変わるんだから継承より集約がいいぞって記事を書いたんだけど社内Goおじさんな僕としては締めくくりにちなみにGoに継承はありませんってしっかり書いといた 😉</p>&mdash; はたじょー (@hatajoe) <a href="https://twitter.com/hatajoe/status/695257306695479297">2016, 2月 4</a></blockquote> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

これについてちょっと。継承と集約の話。

よく継承はis-aの関係が云々とか言うけれど、確かにその通りでis-aじゃない規定クラスを継承したりされたりすると本当に大変。  
そんなことはわかっているのだけれど、実際ゲーム開発などしていると仕様は日々変化するしis-aなんてものはもろくも崩れ去っていく。  
その結果、規定クラスが肥大化して手に負えんみたいなことが起こったり。  

ところで僕はUNIX哲学が好きで。  
初めてLinuxに触ったのが5年前くらいだったと思うけど、あのシンプルなコマンドをパイプやリダイレクトを駆使して組み合わせる感じには感動した覚えがある。  
そうやって複数のコマンドを組み合わせてなんかする.shファイルを作ったり。その時は気が付かなかったけれど、これぞコンポーネント指向であり、UMLで言えば集約、集約と言えばダックタイピングで、ダックタイピングといえばGoである。

コンポーネントは振る舞いであるとええやん？みたいな話は以前書いた。

* [kug2#2 · hatajoe](http://hatajoe.github.io/blog/2016/01/25-kug2-2/)
<br /><br />
集約・コンポーネント指向とダックタイピングは仕様変更に対して結構強力に作用すると感じる。
仕様変更って、

- 変わる
- 無くなる
- 追加する

なんだけど、これを継承でやろうとすると、規定クラスのなんらかを変えたり無くしたり増やしたり、という行為になる。  
この時点で結構嫌な予感がし始めるんだけど、そうやって何かしら変化を加えた規定クラスをextendsしているクラスがis-aの関係を保ち続けるの結構難しい。いや、無理。  

一方、これがコンポーネントを集約している作りであれば、変化する対象からコンポーネントを付け外しするだけで良い。  
Goは静的型付けなのでコンポーネントを外す場合はembeddedしてるsturctを外してコンパイルエラーを潰すだけで修正は完了する。  
コンポーネントの振る舞いが変わる場合は影響範囲を調べる必要があるけど、これは継承の場合であっても同じなはず。

そもそもの思想として、あるアプリケーション内にて定義する例えば鳥は、自然界の鳥である必要はなくてアプリケーションにとって鳥とみなせることが重要で。  
例えば動物という規定クラスをextendsしている必要もなくて、飛べる、鳴くさえ満たしていれば良いみたいな。  
実にシンプルだし柔軟。まるでUNIXコマンドのようだと思う。

そういうわけで継承よりは集約が好きだっていう。




